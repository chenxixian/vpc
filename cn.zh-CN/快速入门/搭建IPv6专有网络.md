# 搭建IPv6专有网络 {#concept_qnx_55q_dgb .concept}

本教程将指引您搭建一个具有IPv6地址块的专有网络（VPC），然后在该VPC中创建一个带有IPv6地址的ECS实例，并可以访问IPv6服务。

## 步骤一：创建VPC {#section_a5p_lvq_dgb .section}

在专有网络中使用云产品，您必须要先做好网络规划，创建好VPC和云产品所属的子网（交换机）。关于如何规划网段，请参见[网络规划](../cn.zh-CN/最佳实践/网络规划.md#)。

完成以下操作创建一个具有IPv6地址块的专有网络和交换机：

1.  登录[专有网络管理控制台](https://vpcnext.console.aliyun.com)。
2.  在顶部菜单栏，选择专有网络的地域。

    专有网络的地域和要部署的云资源的地域必须相同，本操作选择**华北5（呼和浩特）**。

    **说明：** 目前，仅华北5（呼和浩特）地域支持开通IPv6地址块。

3.  根据以下信息配置专有网络和交换机。

    **说明：** 本操作中，选择分配IPv6地址。创建VPC后，系统会自动为您的VPC分配一个掩码为/56的IPv6网段，并免费创建一个IPv6网关。您可以通过IPv6网关控制IPv6地址的流量。更多详细信息，请参见[什么是IPv6网关？](../../cn.zh-CN/产品简介/什么是IPv6网关？.md#)

    |配置|说明|
    |:-|:-|
    |**专有网络配置**|
    |**名称**|专有网络的名称。长度为2-128个字符，以英文字母或中文开头，可包含数字，下划线（\_）和短横线（-）。

|
    |**IPv4网段**|建议您使用RFC私网地址作为专有网络的网段。    -   您可以使用192.168.0.0/16、172.16.0.0/12和10.0.0.0/8这三个标准网段或其子集。如果要使用标准网段的子网作为VPC的网段，需要使用CreateVpcAPI创建VPC。

    -   如果有多个VPC，或者VPC和本地数据中心互连构建混合云的需求，建议使用上面这些标准网段的子网作为VPC的网段，掩码不超过/16。

    -   如果云上只有一个VPC并且不需要和本地数据中心互通，那么选择以上任何一个网段或其子网。

**说明：** VPC创建后，不能再修改IPv4网段。

|
    |**IPv6网段**| 选择是否给VPC分配IPv6网段，默认不分配IPv6网段。

 如果您选择分配IPv6网段，系统将为您的VPC自动分配掩码为/56的IPv6网段，如2001:db8::/56。

 **说明：** VPC创建后，不能再修改IPv6网段。

 |
    |**描述**|输入VPC的描述信息。描述可包含2-256个中英文字符，不能以http://和https://开头。

|
    |**资源组**|选择VPC所属的资源组。|
    |**交换机配置**|
    |**名称**|交换机的名称。长度为2-128个字符，以英文字母或中文开头，可包含数字，下划线（\_）和短横线（-）。

|
    |**可用区**|交换机的可用区。同一VPC内不同可用区的交换机内网互通。|
    |**IPv4网段**|交换机的IPv4网段。交换机的网段限制如下：    -   交换机的网段可以和其所属的VPC网段相同或者是其VPC网段的子集。

例如，VPC的网段是192.168.0.0/16，那么该VPC内的交换机的网段可以是192.168.0.0/16，也可以是192.168.0.0/17，一直到192.168.0.0/29。

**说明：** 如果交换机的网段和专有网络的网段相同，您只能创建一个交换机。

    -   交换机的网段的大小在16位网络掩码与29位网络掩码之间，可提供8-65536个地址。

    -   每个交换机的第一个和最后三个IP地址为系统保留地址。

以192.168.1.0/24为例，192.168.1.0、 192.168.1.253、 192.168.1.254和192.168.1.255这些地址是系统保留地址。

    -   如果该交换机有和其他专有网络的交换机，或本地数据中心通信的需求，确保交换机的网段和要通信的网段不冲突。

**说明：** 交换机创建后，不能再修改网段。

|
    |**IPv6网段**| 交换机的IPv6网段。

 交换机的IPv6网段的掩码默认为/64，您可以输入十进制数字0-255，来自定义交换机IPv6网段的最后8比特位。

 如VPC的IPv6网段为2001:db8::/64，在交换机的IPv6网段输入十进制数字255（对应十六进制为ff），则交换机的IPv6网段将为2001:db8:ff::/64。

 |
    |**描述**|输入交换机的描述信息。描述可包含2-256个中英文字符，不能以http://和https://开头。

|

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/80011/155384334334424_zh-CN.png)


## 步骤二：创建并配置ECS实例 {#section_d2s_s1r_dgb .section}

创建IPv6专有网络和交换机后，您可以创建一个具有IPv6地址的ECS实例。创建ECS实例后，您还需要将分配的IPv6地址配置到ECS实例的网卡上。

完成以下操作，创建并配置ECS实例：

1.  在专有网络控制台的左侧导航栏，单击**交换机**。
2.  在交换机列表页面，找到目标交换机，然后单击**购买** \> **ECS实例**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/80011/155384334334427_zh-CN.png)

3.  根据您的需要选择ECS实例的配置。

    **说明：** 本操作中，ECS实例的网络配置如下：

    -   为了方便登录到ECS实例，进行网卡配置。选择**分配公网IP地址**，带宽选择1Mpbs。您也可以选择不分配公网IP，使用弹性公网IP。
    -   选择**免费分配 IPv6 地址**。
    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/80011/155384334434429_zh-CN.png)

4.  购买完成后，返回ECS实例列表页面。单击实例ID，查看分配的IPv6地址。
5.  配置静态IPv6地址。

    各操作系统配置静态IPv6地址的详细操作，请参见[为 Windows 实例配置 IPv6 地址](../../cn.zh-CN/网络/配置IPv6地址/Windows实例配置IPv6地址/步骤4：配置IPv6地址.md#)和[为 Linux 实例配置 IPv6 地址](../../cn.zh-CN/网络/配置IPv6地址/Linux实例配置IPv6地址/步骤4：配置IPv6地址.md#)。


## （可选）步骤三：开通IPv6公网访问 {#section_qqb_wkr_dgb .section}

默认IPv6地址只具备私网通信能力。如果您需要通过该IPv6地址访问互联网或被互联网中的IPv6客户端访问，您需要开通IPv6公网带宽。

完成以下操作，购买公网带宽：

1.  在专有网络控制台的左侧导航栏，单击**IPv6网关**。
2.  找到目标IPv6网关，然后单击**管理**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/80011/155384334434439_zh-CN.png)

3.  在左侧导航栏，单击**IPv6公网带宽**。
4.  找到ECS实例使用的IPv6地址，然后单击**开通公网带宽**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/80011/155384334434438_zh-CN.png)

5.  选择一种计费方式和公网带宽，然后完成支付。

## 步骤四：配置安全组规则 {#section_ugx_1jr_dgb .section}

在创建IPv6地址的ECS实例后，系统会默认添加一条允许IPv6客户端访问该ECS实例的安全组规则。您可以根据实际需要，修改或新增安全组规则。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/80011/155384334434435_zh-CN.png)

本操作中ECS实例要通过公网访问IPv6服务，所以需要添加一条出方向的安全组规则。操作如下：

1.  在ECS实例列表页面，单击已创建的ECS实例ID。
2.  在ECS实例详情页面，单击**本实例安全组**，然后单击**配置规则**。
3.  单击**添加安全组规则**，然后进行配置。

    本操作中的安全组配置如下：

    -   **规则方向**：出方向
    -   **授权策略**：允许
    -   **协议类型**：全部
    -   **授权类型**：IPv6地址段访问
    -   **授权对象**：::/0

关于添加安全组规则的详细说明，请参见[添加安全组规则](../../cn.zh-CN/安全/安全组/添加安全组规则.md#)。

## 步骤五：测试 {#section_qtm_wqr_dgb .section}

登录到ECS实例，Ping一个IPv6服务测试通信是否正常。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/80011/155384334434440_zh-CN.png)

